<!-- Tell a Friend Tab Content -->
<div class="balance-card p-4">
    <h4 class="mb-4">Tell a Friend</h4>
    
    {% if affiliate and affiliate.status == 'active' %}
        <!-- For active affiliates who have agreed to terms -->
        <div class="mb-4">
            <h5 class="mb-3">Your Referral Link</h5>
            <div class="input-group mb-2">
                <input type="text" class="form-control custom-amount-input" id="referralLink" 
                       value="{{ request.host_url }}?ref={{ affiliate.referral_code }}" readonly>
                <button class="btn btn-outline-secondary" type="button" id="copyReferralLink">
                    <i class="fas fa-copy"></i> Copy
                </button>
            </div>
            <p class="text-muted small">Share this link to earn commissions on your friends' purchases.</p>
        </div>
        
        <div class="mb-4 p-3 border rounded" style="background-color: #1e2124; border-color: #3f4246 !important;">
            <h6><i class="fas fa-lightbulb text-warning"></i> Quick Tip</h6>
            <p class="small mb-0">Want to share a specific page or chat? Just add <code>?ref={{ affiliate.referral_code }}</code> to the end of any GloriaMundo URL!</p>
        </div>
        
        <div class="mb-4">
            <h5 class="mb-3">Commission Summary</h5>
            <div class="row mb-3 text-center">
                <div class="col">
                    <div class="p-3 border rounded" style="background-color: #1e2124; border-color: #3f4246 !important;">
                        <h2 class="text-primary mb-1">{{ commission_stats.total_earned | default('$0.00') }}</h2>
                        <p class="text-muted mb-0 small">Total Earned</p>
                    </div>
                </div>
                <div class="col">
                    <div class="p-3 border rounded" style="background-color: #1e2124; border-color: #3f4246 !important;">
                        <h2 class="text-primary mb-1">{{ commission_stats.pending | default('$0.00') }}</h2>
                        <p class="text-muted mb-0 small">Pending</p>
                    </div>
                </div>
                <div class="col">
                    <div class="p-3 border rounded" style="background-color: #1e2124; border-color: #3f4246 !important;">
                        <h2 class="text-primary mb-1">{{ commission_stats.referrals | default('0') }}</h2>
                        <p class="text-muted mb-0 small">Referrals</p>
                    </div>
                </div>
            </div>
            <a href="{{ url_for('affiliate.dashboard') }}" target="_self" class="btn btn-primary w-100 mb-2">
                <i class="fas fa-chart-line me-2"></i> View Full Dashboard
            </a>
        </div>

        <div class="mb-4">
            <h5 class="mb-3">PayPal Email for Payouts</h5>
            <form action="{{ url_for('affiliate.update_paypal_email') }}" method="post">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <div class="mb-3">
                    <input type="email" class="form-control custom-amount-input" name="paypal_email" 
                           placeholder="your-email@example.com" value="{{ affiliate.paypal_email or '' }}" required>
                    <div class="form-text">We'll send your commission payments to this PayPal email address.</div>
                </div>
                <button type="submit" class="btn btn-primary">
                    {% if affiliate.paypal_email %}Update{% else %}Save{% endif %} PayPal Email
                </button>
            </form>
        </div>
        
    {% else %}
        <!-- For new affiliates who haven't agreed to terms yet -->
        <div class="mb-4">
            <h5 class="mb-3">Welcome to the Affiliate Program!</h5>
            <p>Share GloriaMundo with your friends, followers, or audience and earn commission on their purchases.</p>
            <div class="alert alert-info">
                <i class="fas fa-info-circle me-2"></i> Your referral code is ready, but you need to agree to our Terms &amp; Conditions first.
            </div>
        </div>
        
        <div class="mb-4">
            <h5 class="mb-3">Referral Code Preview</h5>
            <div class="input-group mb-3">
                <input type="text" class="form-control custom-amount-input" disabled
                       value="{{ affiliate.referral_code if affiliate else 'Your referral code will appear here' }}" 
                       style="color: #aaa; background-color: #2c2f33;">
                <button class="btn btn-outline-secondary" type="button" disabled>
                    <i class="fas fa-copy"></i> Copy
                </button>
            </div>
            <p class="text-muted small">This will be activated once you agree to the Terms &amp; Conditions.</p>
        </div>
        
        <div class="mb-4">
            <h5 class="mb-3">Activate Your Affiliate Status</h5>
            <form action="{{ url_for('affiliate.agree_to_terms') }}" method="post">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <div class="mb-3">
                    <label for="paypal_email" class="form-label">Your PayPal Email for Payouts (Optional)</label>
                    <input type="email" class="form-control custom-amount-input" id="paypal_email" name="paypal_email" 
                           placeholder="your-email@example.com">
                    <div class="form-text">We'll send your commission payments to this PayPal email. You can also add this later.</div>
                </div>
                
                <div class="mb-3">
                    <a href="{{ url_for('affiliate.terms') }}" target="_blank" class="d-block mb-2">
                        Read our Affiliate Terms &amp; Conditions
                    </a>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="agreeToTerms" name="agree_to_terms" required>
                        <label class="form-check-label" for="agreeToTerms">
                            I have read and agree to the Affiliate Terms &amp; Conditions
                        </label>
                    </div>
                </div>
                
                <button type="submit" class="btn btn-primary" id="activateReferralBtn" disabled>
                    Activate My Referral Code
                </button>
            </form>
        </div>
    {% endif %}
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Enable/disable activation button based on checkbox
    const agreeCheckbox = document.getElementById('agreeToTerms');
    const activateButton = document.getElementById('activateReferralBtn');
    
    if (agreeCheckbox && activateButton) {
        agreeCheckbox.addEventListener('change', function() {
            activateButton.disabled = !this.checked;
        });
    }
    
    // Copy referral link functionality
    const copyBtn = document.getElementById('copyReferralLink');
    const referralLinkInput = document.getElementById('referralLink');
    
    if (copyBtn && referralLinkInput) {
        copyBtn.addEventListener('click', function() {
            referralLinkInput.select();
            document.execCommand('copy');
            
            // Show feedback
            const originalText = copyBtn.innerHTML;
            copyBtn.innerHTML = '<i class="fas fa-check"></i> Copied!';
            
            setTimeout(function() {
                copyBtn.innerHTML = originalText;
            }, 2000);
        });
    }
});
</script>