<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <meta name="description" content="GloriaMundo - Every AI. One app. No subscription.">
    <title>{% block title %}GloriaMundo{% endblock %}</title>
    
    <!-- Resource hints for faster loading -->
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <link rel="preconnect" href="https://s.skimresources.com" crossorigin>
    <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
    <link rel="dns-prefetch" href="https://s.skimresources.com">
    
    <!-- Preload critical CSS -->
    <link rel="preload" href="{{ url_for('static', filename='css/style.css') }}" as="style">
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" as="style">
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#ffffff">
    <meta name="application-name" content="GloriaMundo">
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='img/favicon-96x96.png') }}" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='img/favicon.svg') }}" />
    <link rel="shortcut icon" href="{{ url_for('static', filename='img/favicon.ico') }}" />
    <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='img/apple-touch-icon.png') }}" />
    <meta name="apple-mobile-web-app-title" content="GloriaMundo" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <link rel="manifest" href="{{ url_for('static', filename='manifest/manifest.json') }}" />
    <!-- Fallback for older browsers -->
    <link rel="manifest" href="{{ url_for('static', filename='img/site.webmanifest') }}" />
    
    <!-- iOS Splash Screens -->
    <link rel="apple-touch-startup-image" media="screen and (device-width: 440px) and (device-height: 956px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="{{ url_for('static', filename='img/splash_screens/iPhone_16_Pro_Max_landscape.png') }}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 402px) and (device-height: 874px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="{{ url_for('static', filename='img/splash_screens/iPhone_16_Pro_landscape.png') }}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="{{ url_for('static', filename='img/splash_screens/iPhone_16_Plus__iPhone_15_Pro_Max__iPhone_15_Plus__iPhone_14_Pro_Max_landscape.png') }}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="{{ url_for('static', filename='img/splash_screens/iPhone_16__iPhone_15_Pro__iPhone_15__iPhone_14_Pro_landscape.png') }}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="{{ url_for('static', filename='img/splash_screens/iPhone_14_Plus__iPhone_13_Pro_Max__iPhone_12_Pro_Max_landscape.png') }}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="{{ url_for('static', filename='img/splash_screens/iPhone_16e__iPhone_14__iPhone_13_Pro__iPhone_13__iPhone_12_Pro__iPhone_12_landscape.png') }}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="{{ url_for('static', filename='img/splash_screens/iPhone_13_mini__iPhone_12_mini__iPhone_11_Pro__iPhone_XS__iPhone_X_landscape.png') }}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="{{ url_for('static', filename='img/splash_screens/iPhone_11_Pro_Max__iPhone_XS_Max_landscape.png') }}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="{{ url_for('static', filename='img/splash_screens/iPhone_11__iPhone_XR_landscape.png') }}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="{{ url_for('static', filename='img/splash_screens/iPhone_8_Plus__iPhone_7_Plus__iPhone_6s_Plus__iPhone_6_Plus_landscape.png') }}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="{{ url_for('static', filename='img/splash_screens/iPhone_8__iPhone_7__iPhone_6s__iPhone_6__4.7__iPhone_SE_landscape.png') }}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="{{ url_for('static', filename='img/splash_screens/4__iPhone_SE__iPod_touch_5th_generation_and_later_landscape.png') }}">
    
    <link rel="apple-touch-startup-image" media="screen and (device-width: 440px) and (device-height: 956px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="{{ url_for('static', filename='img/splash_screens/iPhone_16_Pro_Max_portrait.png') }}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 402px) and (device-height: 874px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="{{ url_for('static', filename='img/splash_screens/iPhone_16_Pro_portrait.png') }}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="{{ url_for('static', filename='img/splash_screens/iPhone_16_Plus__iPhone_15_Pro_Max__iPhone_15_Plus__iPhone_14_Pro_Max_portrait.png') }}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="{{ url_for('static', filename='img/splash_screens/iPhone_16__iPhone_15_Pro__iPhone_15__iPhone_14_Pro_portrait.png') }}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="{{ url_for('static', filename='img/splash_screens/iPhone_14_Plus__iPhone_13_Pro_Max__iPhone_12_Pro_Max_portrait.png') }}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="{{ url_for('static', filename='img/splash_screens/iPhone_16e__iPhone_14__iPhone_13_Pro__iPhone_13__iPhone_12_Pro__iPhone_12_portrait.png') }}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="{{ url_for('static', filename='img/splash_screens/iPhone_13_mini__iPhone_12_mini__iPhone_11_Pro__iPhone_XS__iPhone_X_portrait.png') }}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="{{ url_for('static', filename='img/splash_screens/iPhone_11_Pro_Max__iPhone_XS_Max_portrait.png') }}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="{{ url_for('static', filename='img/splash_screens/iPhone_11__iPhone_XR_portrait.png') }}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="{{ url_for('static', filename='img/splash_screens/iPhone_8_Plus__iPhone_7_Plus__iPhone_6s_Plus__iPhone_6_Plus_portrait.png') }}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="{{ url_for('static', filename='img/splash_screens/iPhone_8__iPhone_7__iPhone_6s__iPhone_6__4.7__iPhone_SE_portrait.png') }}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="{{ url_for('static', filename='img/splash_screens/4__iPhone_SE__iPod_touch_5th_generation_and_later_portrait.png') }}">
    
    <!-- iPad Splash Screens -->
    <link rel="apple-touch-startup-image" media="screen and (device-width: 1032px) and (device-height: 1376px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="{{ url_for('static', filename='img/splash_screens/13__iPad_Pro_M4_portrait.png') }}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="{{ url_for('static', filename='img/splash_screens/12.9__iPad_Pro_portrait.png') }}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 834px) and (device-height: 1210px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="{{ url_for('static', filename='img/splash_screens/11__iPad_Pro_M4_portrait.png') }}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="{{ url_for('static', filename='img/splash_screens/11__iPad_Pro__10.5__iPad_Pro_portrait.png') }}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 820px) and (device-height: 1180px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="{{ url_for('static', filename='img/splash_screens/10.9__iPad_Air_portrait.png') }}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="{{ url_for('static', filename='img/splash_screens/10.5__iPad_Air_portrait.png') }}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="{{ url_for('static', filename='img/splash_screens/10.2__iPad_portrait.png') }}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="{{ url_for('static', filename='img/splash_screens/9.7__iPad_Pro__7.9__iPad_mini__9.7__iPad_Air__9.7__iPad_portrait.png') }}">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 744px) and (device-height: 1133px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="{{ url_for('static', filename='img/splash_screens/8.3__iPad_Mini_portrait.png') }}">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    {% block styles %}
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Main CSS (must be after Bootstrap for proper overrides) -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}?v={{ now.timestamp() if now else '20250519' }}">
    <!-- Cookie Consent CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/cookie_consent.css') }}">
    {% endblock %}
</head>
<body class="{% block body_class %}{% endblock %}">
    {% if request.path.startswith('/share/') %}
    <!-- Header for shared conversations -->
    <header>
        <nav class="navbar">
            <div class="navbar-brand">
                <a href="{{ url_for('index') }}">
                    <img src="{{ url_for('static', filename='img/light-logo.svg') }}" alt="GloriaMundo" class="logo">
                </a>
            </div>
            
            <div class="navbar-shared-indicator">
                <span><i class="fa-solid fa-share-nodes"></i> Shared Conversation</span>
            </div>
            
            <div class="navbar-actions">
                {% if current_user.is_authenticated %}
                <a href="{{ url_for('billing.account') }}" class="account-link" title="Account">
                    <i class="fa-solid fa-user"></i>
                    <span>Credits: ${{ '%.2f'|format(current_user.credit_balance|float) }}</span>
                </a>
                <a href="{{ url_for('logout') }}" id="logout-btn" class="btn auth-btn">
                    <i class="fa-solid fa-sign-out-alt"></i> Logout
                </a>
                {% else %}
                <a href="{{ url_for('login') }}" class="btn auth-btn">Sign In</a>
                {% endif %}
            </div>
        </nav>
    </header>
    {% endif %}
    
    {% block content %}{% endblock %}
    
    <!-- Global Footer (only visible in certain pages) -->
    {% block footer %}
    <div class="global-footer-links" style="display: none;">
        <a href="{{ url_for('terms_of_service') }}">Terms of Service</a>
        <a href="{{ url_for('privacy_policy') }}">Privacy Policy</a>
        <a href="{{ url_for('cookie_policy') }}">Cookie Policy</a>
        <a href="#cookie-settings" id="open-cookie-settings">Cookie Settings</a>
        <span class="copyright">© {{ now.year }} Sentigral Limited</span>
    </div>
    {% endblock %}
    
    {% block scripts %}
    <!-- Bootstrap JS Bundle with Popper (critical for UI functionality) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Main JavaScript (deferred to not block rendering) -->
    <script defer src="{{ url_for('static', filename='js/script.js') }}?v={{ config.get('ASSETS_VERSION', '1.0') }}"></script>
    
    <!-- API Fetch Error Fix -->
    {% include 'base_includes/fetch_error_fix.html' %}
    
    <!-- Cookie Consent JavaScript (non-critical, can be deferred) -->
    <script defer src="{{ url_for('static', filename='js/cookie_consent.js') }}?v={{ config.get('ASSETS_VERSION', '1.0') }}"></script>
    
    <!-- Mobile responsiveness JavaScript (lower priority) -->
    <script defer src="{{ url_for('static', filename='js/mobile.js') }}?v={{ config.get('ASSETS_VERSION', '1.0') }}" fetchpriority="low"></script>
    
    <!-- Mobile model selector JavaScript (lower priority) -->
    <script defer src="{{ url_for('static', filename='js/mobile_model_selector.js') }}?v={{ config.get('ASSETS_VERSION', '1.0') }}" fetchpriority="low"></script>
    
    <!-- Message collapsing functionality -->
    <script defer src="{{ url_for('static', filename='js/message-collapse.js') }}?v={{ config.get('ASSETS_VERSION', '1.0') }}"></script>
    
    <!-- Skimlinks - Automatic Affiliate Link Generator (lowest priority) -->
    <script defer type="text/javascript" src="https://s.skimresources.com/js/44501X1766367.skimlinks.js" fetchpriority="low"></script>
    
    <!-- PWA Service Worker Registration -->
    <script defer src="{{ url_for('static', filename='js/pwa.js') }}?v={{ config.get('ASSETS_VERSION', '1.0') }}"></script>
    {% endblock %}
</body>
</html>