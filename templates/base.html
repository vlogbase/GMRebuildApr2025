<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <title>{% block title %}GloriaMundo Chat{% endblock %}</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='img/favicon-96x96.png') }}" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='img/favicon.svg') }}" />
    <link rel="shortcut icon" href="{{ url_for('static', filename='img/favicon.ico') }}" />
    <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='img/apple-touch-icon.png') }}" />
    <meta name="apple-mobile-web-app-title" content="GloriaMundo" />
    <link rel="manifest" href="{{ url_for('static', filename='img/site.webmanifest') }}" />
    
    <!-- Preconnect to external domains -->
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    
    <!-- Inline critical CSS for above-the-fold content -->
    <style>
        {% include 'static/css/critical.css' %}

        /* Critical icon styles */
        .fa-plus:before { content: "\2b"; }
        .fa-paper-plane:before { content: "\f1d8"; }
        .fa-robot:before { content: "\f544"; }
        .fa-brain:before { content: "\f5dc"; }
        .fa-image:before { content: "\f03e"; }
        .fa-search:before { content: "\f002"; }
        .fa-gift:before { content: "\f06b"; }
        .fa-file-circle-plus:before { content: "\e494"; }
        .fa-camera:before { content: "\f030"; }
        .fa-chevron-down:before { content: "\f078"; }
        .fa-sync-alt:before { content: "\f2f1"; }
    </style>
    
    {% block styles %}
    <!-- Preload critical CSS files -->
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" as="style">
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" as="style">
    
    <!-- Full Font Awesome loaded with non-blocking technique -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" media="print" onload="this.media='all'">
    
    <!-- Bootstrap loaded with non-blocking technique (after critical CSS inline) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" media="print" onload="this.media='all'">
    
    <!-- Main CSS (loaded async with preload) -->
    <link rel="preload" href="{{ url_for('static', filename='css/style.css') }}" as="style">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" media="print" onload="this.media='all'">
    
    <!-- Cookie Consent CSS (non-critical) -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/cookie_consent.css') }}" media="print" onload="this.media='all'">
    
    <!-- Fallbacks for browsers that don't support onload -->
    <noscript>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
        <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
        <link rel="stylesheet" href="{{ url_for('static', filename='css/cookie_consent.css') }}">
    </noscript>
    {% endblock %}
</head>
<body class="{% block body_class %}{% endblock %}">
    {% if request.path.startswith('/share/') %}
    <!-- Header for shared conversations -->
    <header>
        <nav class="navbar">
            <div class="navbar-brand">
                <a href="{{ url_for('index') }}">
                    <img src="{{ url_for('static', filename='img/logo.svg') }}" alt="GloriaMundo" class="logo">
                </a>
            </div>
            
            <div class="navbar-shared-indicator">
                <span><i class="fa-solid fa-share-nodes"></i> Shared Conversation</span>
            </div>
            
            <div class="navbar-actions">
                {% if current_user.is_authenticated %}
                <a href="{{ url_for('billing.account') }}" class="account-link" title="Account">
                    <i class="fa-solid fa-user"></i>
                    <span>Credits: ${{ '%.2f'|format(current_user.credit_balance|float) }}</span>
                </a>
                <a href="{{ url_for('logout') }}" id="logout-btn" class="btn auth-btn">
                    <i class="fa-solid fa-sign-out-alt"></i> Logout
                </a>
                {% else %}
                <a href="{{ url_for('login') }}" class="btn auth-btn">Sign In</a>
                {% endif %}
            </div>
        </nav>
    </header>
    {% endif %}
    
    {% block content %}{% endblock %}
    
    <!-- Global Footer (only visible in certain pages) -->
    {% block footer %}
    <div class="global-footer-links" style="display: none;">
        <a href="{{ url_for('terms_of_service') }}">Terms of Service</a>
        <a href="{{ url_for('privacy_policy') }}">Privacy Policy</a>
        <a href="{{ url_for('cookie_policy') }}">Cookie Policy</a>
        <a href="javascript:void(0)" id="open-cookie-settings">Cookie Settings</a>
        <span class="copyright">Â© {{ now.year }} Sentigral Limited</span>
    </div>
    {% endblock %}
    
    {% block scripts %}
    <!-- Critical UI Bootstrap JavaScript - runs immediately -->
    <script src="{{ url_for('static', filename='js/bootstrap.js') }}"></script>
    
    <!-- Bootstrap JS Bundle with Popper - load with medium priority -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" defer></script>
    
    <!-- Main JavaScript - critical for functionality but can load after initial render -->
    <script src="{{ url_for('static', filename='js/script.js') }}" defer></script>
    
    <!-- Cookie Consent JavaScript - load after page is interactive -->
    <script src="{{ url_for('static', filename='js/cookie_consent.js') }}" defer></script>
    
    <!-- Skimlinks - Automatic Affiliate Link Generator - load with low priority -->
    <script type="text/javascript" src="https://s.skimresources.com/js/44501X1766367.skimlinks.js" async></script>
    {% endblock %}
</body>
</html>